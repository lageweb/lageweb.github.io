webpackJsonp([1],{0:function(t,e,n){t.exports=n("cDNt")},cDNt:function(t,e,n){"use strict";function r(t){return a._17(0,[a._14(402653184,1,{canvasRef:0}),(t()(),a._3(1,0,[[1,0],["vpCanvas",1]],null,1,"canvas",[["height","800"],["style","cursor: none;"],["width","1280"]],null,null,null,null,null)),(t()(),a._16(-1,null,["\n"]))],null,null)}function i(t){return a._17(0,[(t()(),a._3(0,0,null,null,1,"app-viewport",[],null,null,null,r,L)),a._1(1,114688,null,0,P,[a.z,R.c],null,null)],function(t,e){t(e,1,0)},null)}function o(t){return a._17(0,[(t()(),a._3(0,0,null,null,1,"app-viewport",[],null,null,null,r,L)),a._1(1,114688,null,0,P,[a.z,R.c],null,null)],function(t,e){t(e,1,0)},null)}function s(t){return a._17(0,[(t()(),a._3(0,0,null,null,1,"app-root",[],null,null,null,o,D)),a._1(1,49152,null,0,c,[],null,null)],null,null)}Object.defineProperty(e,"__esModule",{value:!0});var a=n("/oeL"),h={production:!0},u=function(){function t(){}return t}(),c=function(){function t(){this.title="app"}return t}(),l=[""],f=[""],_=function(){function t(t,e){this.x=t,this.y=e}return t}(),p=function(){function t(t,e,n,r){this.x=t,this.y=e,this.width=n,this.height=r}return t}(),d=function(){function t(t,e,n,r){this.tex=t,this.name=e,this.images=n,this.rect=r,this.state=1}return t.prototype.vertices=function(t){var e=this,n=this.state<1?[]:this.images[this.state-1];if(!n)return[];var r=[];return Object.keys(n).forEach(function(i){var o=n[i],s=e.tex.vertices(t,Number(i),new p(o[0],o[1],o[2],o[3]),new p(e.rect[0],e.rect[1],e.rect[2],e.rect[3]));r.push.apply(r,s)}),r},t}(),x=function(){function t(t,e){this.name=t,this.objs=[],this.tex=e.newTexture()}return t.prototype.load=function(t){var e=this;return Promise.all([this.tex.fromImage("assets/images/"+this.name+".png"),t.get("assets/jsons/"+this.name+".json").toPromise().then(function(t){for(var n in t.objects){var r=t.objects[n],i=r.name,o=r.images,s=r.rect;e.objs.push(new d(e.tex,i,o,s))}var a=t.background,h=a.name,u=a.images,c=a.rect;e.objs.push(new d(e.tex,h,u,c))})])},t.prototype.vertices=function(t){return this.objs.reduce(function(e,n){return e.concat(n.vertices(t))},[])},t}(),m="\n\nattribute vec3 a_position;\nattribute vec2 a_texcoord;\nattribute float a_texindex;\n\nvarying vec2 v_texcoord;\nvarying float v_texindex;\n\nvoid main() {\n    gl_Position = vec4(a_position, 1.0);\n    v_texcoord = a_texcoord;\n    v_texindex = a_texindex;\n}\n\n",g="\n\n#define MAX_TEXTURES 8\n\nprecision mediump float;\n\nvarying vec2 v_texcoord;\nvarying float v_texindex;\n\nuniform sampler2D u_texture;\n\nvoid main() {\n  vec4 color = texture2D(u_texture, v_texcoord);\n  if (color.a == 0.0) {\n    discard;\n  }\n  gl_FragColor = color;\n}\n\n",E=function(){function t(t){this.gl=t,this.offset=new _(0,0)}return t.prototype.createTexture=function(t,e,n){var r=this.gl;this.tex=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this.tex),t?(r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e,n,0,r.RGBA,r.UNSIGNED_BYTE,t),this.width=e,this.height=n):(r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,this.img),this.width=this.img.width,this.height=this.img.height,this.img=void 0),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR)},t.prototype.fromImage=function(t){var e=this;return this.img=new Image,new Promise(function(n,r){e.img.src=t,e.img.addEventListener("load",function(){e.createTexture(),n()})})},t.prototype.vertices=function(t,e,n,r,i){r.x+=this.offset.x-t.x,r.y+=this.offset.y-t.y;var o=(e+1)/100,s=2*r.x/t.width-1,a=2*(r.x+r.width)/t.width-1,h=2*r.y/t.height-1,u=2*(r.y+r.height)/t.height-1,c=n.x/this.width,l=(n.x+n.width)/this.width,f=n.y/this.height,_=(n.y+n.height)/this.height;if(i){var p=c;c=l,l=p}return[s,-h,o,c,f,a,-h,o,l,f,s,-u,o,c,_,a,-h,o,l,f,s,-u,o,c,_,a,-u,o,l,_]},t.prototype.bind=function(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.tex)},t.prototype.fromText=function(t,e,n){var r=t.getTextRect(e),i=r.x,o=r.y,s=r.width,a=r.height,h=new Uint8Array(4*s*a);h.fill(0),t.render(e,h,s,-i,-o,n),this.createTexture(h,s,a),this.offset.x=i,this.offset.y=o},t}(),v=function(){function t(t){this.gl=t,this.pos=new _(0,0),this.tex=new E(t)}return t.prototype.setText=function(t,e,n){this.text===t&&e.name===this.font.name||(this.tex.fromText(e,t,n),this.text=t,this.font=e)},t.prototype.vertices=function(t){return this.tex.vertices(t,98,new p(0,0,this.tex.width,this.tex.height),new p(this.pos.x,this.pos.y,this.tex.width,this.tex.height))},t}(),T=function(){function t(t,e){this.gl=t,this.VERTEX_ELEMENTS=5,t.viewport(e.x,e.y,e.width,e.height),t.clearColor(0,0,0,1),t.clearDepth(0),t.enable(t.DEPTH_TEST),t.depthFunc(t.GREATER),this.program=this.initShaderProgram(t,m,g),this.positionLocation=t.getAttribLocation(this.program,"a_position"),this.texcoordLocation=t.getAttribLocation(this.program,"a_texcoord"),this.texindexLocation=t.getAttribLocation(this.program,"a_texindex"),this.positionBuffer=t.createBuffer()}return t.prototype.newTexture=function(){return new E(this.gl)},t.prototype.newText=function(){return new v(this.gl)},t.prototype.render=function(t,e){var n=this.gl,r=this.VERTEX_ELEMENTS*Float32Array.BYTES_PER_ELEMENT,i=e.vertices(t);e.tex.bind(),n.bindBuffer(n.ARRAY_BUFFER,this.positionBuffer),n.bufferData(n.ARRAY_BUFFER,new Float32Array(i),n.STATIC_DRAW),n.vertexAttribPointer(this.positionLocation,3,n.FLOAT,!1,r,0*Float32Array.BYTES_PER_ELEMENT),n.enableVertexAttribArray(this.positionLocation),n.vertexAttribPointer(this.texcoordLocation,2,n.FLOAT,!1,r,3*Float32Array.BYTES_PER_ELEMENT),n.enableVertexAttribArray(this.texcoordLocation);var o=i.length/this.VERTEX_ELEMENTS;n.drawArrays(n.TRIANGLES,0,o)},t.prototype.clear=function(){this.gl.useProgram(this.program),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)},t.prototype.loadShader=function(t,e,n){var r=t.createShader(e);return t.shaderSource(r,n),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)?r:(console.error("An error occurred compiling the shaders: "+t.getShaderInfoLog(r)),t.deleteShader(r),null)},t.prototype.initShaderProgram=function(t,e,n){var r=this.loadShader(t,t.VERTEX_SHADER,e),i=this.loadShader(t,t.FRAGMENT_SHADER,n),o=t.createProgram();return t.attachShader(o,r),t.attachShader(o,i),t.linkProgram(o),t.getProgramParameter(o,t.LINK_STATUS)?o:(alert("Unable to initialize the shader program: "+t.getProgramInfoLog(o)),null)},t}(),y=Math.floor(10),w=function(){function t(t){this.tex=t,this.pos=new _(0,0),this.frame=0}return t.prototype.update=function(t){var e=this.tex.width/3;this.pos.x=t.x-Math.floor(e/2),this.pos.y=t.y-Math.floor(e/2)},t.prototype.vertices=function(t){var e=this.tex.width/3,n=Math.floor(this.frame/y);n=n>2?n-2:0;var r=e*n;return this.frame=(this.frame+1)%(5*y),this.tex.vertices(t,99,new p(r,0,e,e),new p(this.pos.x,this.pos.y,e,e))},t}(),R=n("XKz0"),A=function(){function t(t){var e=t.char,n=t.offset,r=t.size;this.char=e,this.x=n[0],this.y=n[1],this.width=r[0],this.height=r[1]}return t.prototype.render=function(t,e,n,r,i,o){for(var s=4*r+4*this.x,a=this,h=0;h<this.height;++h)!function(r){var h=i+a.y+r,u=4*h*n+s;a.char[r].forEach(function(n,r){var i=o&&1==n?o:t[n];i&&i.forEach(function(t,n){e[u+i.length*r+n]=t})})}(h)},t}(),b=function(){function t(t){this.name=t}return t.prototype.createCharset=function(t){var e=t.height,n=t.colors,r=t.chars;this.height=e,this.colors=[null].concat(n.map(function(t){return[t[0],t[1],t[2],255]})),this.chars={};for(var i in r)this.chars[i]=new A(r[i])},t.prototype.load=function(t){var e=this;return this.chars?Promise.resolve():t.get("assets/fonts/"+this.name+".json").toPromise().then(function(t){return e.createCharset(t)})},t.prototype.getTextRect=function(t){for(var e=0,n=0,r=0,i=!0,o=0;o<t.length;++o){var s=this.chars[t.charCodeAt(o)];if(s){s.y<0&&s.y,i&&s.x<e&&(i=!1,e=s.x);var a=s.x+s.width,h=s.y+s.height;n+=a,h>r&&(r=h)}}return{x:e,y:0,width:n-e,height:r-0}},t.prototype.render=function(t,e,n,r,i,o){for(var s=0;s<t.length;++s){var a=this.chars[t.charCodeAt(s)];a.render(this.colors,e,n,r,i,o),r+=a.x+a.width}},t}(),P=function(){function t(t,e){this.ngZone=t,this.http=e,this.frames=0,this.lastTimestamp=Date.now(),this.mouse=new _(0,0),this.fonts={},this.camera=new p(0,0,320,200),this.fixedCamera=new p(0,0,320,200)}return t.prototype.createRoom=function(t){return this.room=new x(t,this.renderer),this.room.load(this.http)},t.prototype.createCursor=function(t){var e=this.renderer.newTexture();return this.cursor=new w(e),e.fromImage("assets/images/cursor.png")},t.prototype.createFont=function(t){var e=this.fonts[t];return e||(e=new b(t),this.fonts[t]=e),e.load(this.http)},t.prototype.ngOnInit=function(){var t=this,e=this.canvasRef.nativeElement.getContext("webgl");this.canvasRef.nativeElement.addEventListener("mousemove",function(e){return t.mouseMove(e)}),this.renderer=new T(e,new p(0,0,e.canvas.width,e.canvas.height)),this.texts=[this.renderer.newText(),this.renderer.newText()],Promise.all([this.createRoom("Atlantis_09"),this.createCursor(e),this.createFont("Atlantis_65_Charset00"),this.createFont("Atlantis_65_Charset01")]).then(function(){t.running=!0,t.ngZone.runOutsideAngular(function(){return t.render()})})},t.prototype.mouseMove=function(t){var e=t.target.getBoundingClientRect();this.mouse.x=Math.floor(320*(t.clientX-e.left-1)/e.width),this.mouse.y=Math.floor(200*(t.clientY-e.top-1)/e.height),this.cursor.update(this.mouse)},t.prototype.render=function(){var t=this;if(this.running){this.canvasRef.nativeElement.getContext("webgl");if(this.texts[0].setText("Hello world!!!",this.fonts.Atlantis_65_Charset00),this.texts[0].pos.x=100,this.texts[0].pos.y=100,this.texts[1].setText("Hello again$$%%",this.fonts.Atlantis_65_Charset01),this.texts[1].pos.x=150,this.texts[1].pos.y=50,this.renderer.clear(),this.renderer.render(this.camera,this.room),this.texts.forEach(function(e){return t.renderer.render(t.fixedCamera,e)}),this.renderer.render(this.fixedCamera,this.cursor),++this.frames%500==0){var e=Date.now();console.log("Frame rate: "+5e5/(e-this.lastTimestamp)+" fps"),this.lastTimestamp=e}this.mouse.x>.8*this.fixedCamera.width&&this.camera.x<300&&this.camera.x++,this.mouse.x<.2*this.fixedCamera.width&&this.camera.x>0&&this.camera.x--,requestAnimationFrame(function(){return t.render()})}},t.ctorParameters=function(){return[{type:a.z},{type:R.c}]},t}(),S=[f],L=a._0({encapsulation:0,styles:S,data:{}}),F=(a.Y("app-viewport",P,i,{},{},[]),[l]),D=a._0({encapsulation:0,styles:F,data:{}}),C=a.Y("app-root",c,s,{},{},[]),X=n("qbdv"),I=n("fc+i"),U=a.Z(u,[c],function(t){return a._12([a._13(512,a.i,a.W,[[8,[C]],[3,a.i],a.x]),a._13(5120,a.v,a._11,[[3,a.v]]),a._13(4608,X.d,X.c,[a.v]),a._13(4608,a.h,a.h,[]),a._13(5120,a.a,a._4,[]),a._13(5120,a.t,a._9,[]),a._13(5120,a.u,a._10,[]),a._13(4608,I.b,I.s,[X.b]),a._13(6144,a.H,null,[I.b]),a._13(4608,I.e,I.f,[]),a._13(5120,I.c,function(t,e,n,r){return[new I.k(t),new I.o(e),new I.n(n,r)]},[X.b,X.b,X.b,I.e]),a._13(4608,I.d,I.d,[I.c,a.z]),a._13(135680,I.m,I.m,[X.b]),a._13(4608,I.l,I.l,[I.d,I.m]),a._13(6144,a.F,null,[I.l]),a._13(6144,I.p,null,[I.m]),a._13(4608,a.L,a.L,[a.z]),a._13(4608,I.g,I.g,[X.b]),a._13(4608,I.i,I.i,[X.b]),a._13(4608,R.h,R.m,[X.b,a.B,R.k]),a._13(4608,R.n,R.n,[R.h,R.l]),a._13(5120,R.a,function(t){return[t]},[R.n]),a._13(4608,R.j,R.j,[]),a._13(6144,R.i,null,[R.j]),a._13(4608,R.g,R.g,[R.i]),a._13(6144,R.b,null,[R.g]),a._13(5120,R.f,R.o,[R.b,[2,R.a]]),a._13(4608,R.c,R.c,[R.f]),a._13(512,X.a,X.a,[]),a._13(1024,a.l,I.q,[]),a._13(1024,a.b,function(t,e){return[I.r(t,e)]},[[2,I.h],[2,a.y]]),a._13(512,a.c,a.c,[[2,a.b]]),a._13(131584,a._2,a._2,[a.z,a.X,a.r,a.l,a.i,a.c]),a._13(2048,a.e,null,[a._2]),a._13(512,a.d,a.d,[a.e]),a._13(512,I.a,I.a,[[3,I.a]]),a._13(512,R.e,R.e,[]),a._13(512,R.d,R.d,[]),a._13(512,u,u,[]),a._13(256,R.k,"XSRF-TOKEN",[]),a._13(256,R.l,"X-XSRF-TOKEN",[])])});h.production&&Object(a.R)(),Object(I.j)().bootstrapModuleFactory(U).catch(function(t){return console.log(t)})},gFIY:function(t,e){function n(t){return Promise.resolve().then(function(){throw new Error("Cannot find module '"+t+"'.")})}n.keys=function(){return[]},n.resolve=n,t.exports=n,n.id="gFIY"}},[0]);