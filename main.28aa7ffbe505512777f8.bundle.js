webpackJsonp([1],{0:function(t,e,n){t.exports=n("cDNt")},cDNt:function(t,e,n){"use strict";function r(t){return h._17(0,[h._14(402653184,1,{canvasRef:0}),(t()(),h._3(1,0,[[1,0],["vpCanvas",1]],null,1,"canvas",[["height","800"],["style","cursor: none;"],["width","1280"]],null,null,null,null,null)),(t()(),h._16(-1,null,["\n"]))],null,null)}function i(t){return h._17(0,[(t()(),h._3(0,0,null,null,1,"app-viewport",[],null,null,null,r,X)),h._1(1,114688,null,0,U,[h.z,m.c],null,null)],function(t,e){t(e,1,0)},null)}function o(t){return h._17(0,[(t()(),h._3(0,0,null,null,1,"app-viewport",[],null,null,null,r,X)),h._1(1,114688,null,0,U,[h.z,m.c],null,null)],function(t,e){t(e,1,0)},null)}function s(t){return h._17(0,[(t()(),h._3(0,0,null,null,1,"app-root",[],null,null,null,o,j)),h._1(1,49152,null,0,l,[],null,null)],null,null)}Object.defineProperty(e,"__esModule",{value:!0});var a,h=n("/oeL"),u={production:!0},c=function(){function t(){}return t}(),l=function(){function t(){this.title="app"}return t}(),f=[""],p=[""],m=n("XKz0"),d="\n\nattribute vec3 a_position;\nattribute vec2 a_texcoord;\n\nuniform vec4 u_camera;\nuniform vec2 u_texrect;\n\nvarying vec2 v_texcoord;\n\nvoid main() {\n    gl_Position.x = -1.0 + 2.0 * (a_position.x - u_camera[0]) / u_camera[2];\n    gl_Position.y = 1.0 - 2.0 * (a_position.y - u_camera[1]) / u_camera[3];\n    gl_Position.z = (a_position.z + 1.0) / 100.0;\n    gl_Position.w = 1.0;\n    v_texcoord = a_texcoord / u_texrect;\n}\n\n",x="\n\nprecision mediump float;\n\nvarying vec2 v_texcoord;\nvarying float v_texindex;\n\nuniform sampler2D u_texture;\n\nvoid main() {\n  vec4 color = texture2D(u_texture, v_texcoord);\n  if (color.a == 0.0) {\n    discard;\n  }\n  gl_FragColor = color;\n}\n\n",_=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t}(),v=function(){function t(t,e,n,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=0),this.x=t,this.y=e,this.w=n,this.h=r}return t}(),g=function(){function t(t){this.gl=t,this.offset=new _(0,0)}return t.prototype.createTexture=function(){var t=this.gl;this.tex=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.tex),this.surface?(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,this.surface),this.surface=void 0):(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this.img),this.width=this.img.width,this.height=this.img.height,this.img=void 0),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)},t.prototype.fromImage=function(t){var e=this;return this.img=new Image,new Promise(function(n,r){e.img.src="assets/images/"+t+".png",e.img.addEventListener("load",function(){e.createTexture(),n()})})},t.prototype.vertices=function(t,e,n,r,i){var o=r.x,s=r.x+r.w,a=r.y,h=r.y+r.h,u=i?n.x+n.w:n.x,c=i?n.x:n.x+n.w,l=n.y,f=n.y+n.h;return[o,a,e,u,l,s,a,e,c,l,o,h,e,u,f,s,a,e,c,l,o,h,e,u,f,s,h,e,c,f]},t.prototype.bind=function(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.tex)},t.prototype.newSurface=function(t,e){this.surface=new Uint8Array(t*e*4),this.surface.fill(0),this.width=t,this.height=e},t.prototype.setColor=function(t,e,n,r,i,o){var s=4*(this.width*e+t);this.surface[s+0]=n,this.surface[s+1]=r,this.surface[s+2]=i,this.surface[s+3]=o},t.prototype.fromSurface=function(){this.surface&&this.createTexture()},t}(),y=function(){function t(t){this.gl=t,this.VERTEX_ELEMENTS=5,t.clearColor(0,0,0,1),t.clearDepth(0),t.enable(t.DEPTH_TEST),t.depthFunc(t.GREATER),this.program=this.initShaderProgram(t,d,x),this.positionLocation=t.getAttribLocation(this.program,"a_position"),this.texcoordLocation=t.getAttribLocation(this.program,"a_texcoord"),this.cameraLocation=t.getUniformLocation(this.program,"u_camera"),this.texrectLocation=t.getUniformLocation(this.program,"u_texrect"),this.textureLocation=t.getUniformLocation(this.program,"u_texture"),this.positionBuffer=t.createBuffer()}return Object.defineProperty(t.prototype,"viewport",{set:function(t){this.gl.viewport(t.x,t.y,t.w,t.h)},enumerable:!0,configurable:!0}),t.prototype.newTexture=function(){return new g(this.gl)},t.prototype.render=function(t,e){var n=this.gl,r=this.VERTEX_ELEMENTS*Float32Array.BYTES_PER_ELEMENT,i=e.vertices(t);if(0!=i.length){e.tex.bind(),n.activeTexture(n.TEXTURE0),n.bindBuffer(n.ARRAY_BUFFER,this.positionBuffer),n.uniform1i(this.textureLocation,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array(i),n.STATIC_DRAW),n.vertexAttribPointer(this.positionLocation,3,n.FLOAT,!1,r,0*Float32Array.BYTES_PER_ELEMENT),n.enableVertexAttribArray(this.positionLocation),n.vertexAttribPointer(this.texcoordLocation,2,n.FLOAT,!1,r,3*Float32Array.BYTES_PER_ELEMENT),n.enableVertexAttribArray(this.texcoordLocation),n.uniform4fv(this.cameraLocation,new Float32Array([t.x,t.y,t.w,t.h])),n.uniform2fv(this.texrectLocation,new Float32Array([e.tex.width,e.tex.height]));var o=i.length/this.VERTEX_ELEMENTS;n.drawArrays(n.TRIANGLES,0,o)}},t.prototype.clear=function(){this.gl.useProgram(this.program),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)},t.prototype.loadShader=function(t,e,n){var r=t.createShader(e);return t.shaderSource(r,n),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)?r:(console.error("An error occurred compiling the shaders: "+t.getShaderInfoLog(r)),t.deleteShader(r),null)},t.prototype.initShaderProgram=function(t,e,n){var r=this.loadShader(t,t.VERTEX_SHADER,e),i=this.loadShader(t,t.FRAGMENT_SHADER,n),o=t.createProgram();return t.attachShader(o,r),t.attachShader(o,i),t.linkProgram(o),t.getProgramParameter(o,t.LINK_STATUS)?o:(alert("Unable to initialize the shader program: "+t.getProgramInfoLog(o)),null)},t}();!function(t){t[t.Stop=121]="Stop",t[t.Start=122]="Start"}(a||(a={}));var w=function(){function t(t,e,n){this.move=new _(t[0],t[1]),this.clip=new v(e[0],e[1],e[2],e[3]),this.rel=new _(n[0],n[1])}return t}(),E=function(){function t(t,e){void 0===t&&(t=[]),void 0===e&&(e=!1),this.frames=t,this.noLoop=e}return t}(),T=function(){function t(t){this.name=t,this.rect=new v(0,0,0,0),this.frames={},this.animations={},this.currentAnimation={},this.currentFrames=[],this.pos=new _(0,0),this.stopped=0}return t.prototype.loadFrames=function(t){for(var e in t){var n={};this.frames[e]=n;var r=t[e];for(var i in r){var o=r[i],s=o.move,a=o.texture,h=o.rel;n[i]=new w(s,a,h)}}},t.prototype.loadAnimations=function(t){for(var e in t){var n={};this.animations[e]=n;var r=t[e][0];for(var i in r){var o=r[i],s=o.frames,a=o.noLoop,h=new E(s,a);n[i]=h}}},t.prototype.update=function(t,e,n,r){this.scale=n,this.light=r,this.pos=t,this.z=e;var i=new _(Number.MAX_VALUE,Number.MAX_VALUE),o=new _(0,0);this.currentFrames=[];for(var s=16;s>0;--s){var a=s-1;if(!(this.stopped&1<<a)){var h=this.currentAnimation[a];if(void 0!==h){var u=Math.floor(this.numFrames/6)%h.frames.length,c=h.frames[u],l=this.frames[a],f=l[c];if(void 0!==f){this.currentFrames.push(f);var p=new v,m=Object.assign({},f.rel);this.flip&&(m.x=-(m.x+f.clip.w)),p.x=Math.floor(m.x*this.scale),p.y=Math.floor(m.y*this.scale),p.w=Math.ceil(f.clip.w*n),p.h=Math.ceil(f.clip.h*n),p.x<i.x&&(i.x=p.x),p.y<i.y&&(i.y=p.y),p.x+p.w>o.x&&(o.x=p.x+p.w),p.y+p.h>o.y&&(o.y=p.y+p.h)}}}}this.rect.x=this.pos.x+i.x,this.rect.y=this.pos.y+i.y,this.rect.w=o.x-i.x,this.rect.h=o.y-i.y,++this.numFrames},t.prototype.load=function(t,e){var n=this;return this.tex=e.newTexture(),Promise.all([this.tex.fromImage(this.name),t.loadJson(this.name).then(function(t){var e=t.frames,r=t.animations;n.loadFrames(e),n.loadAnimations(r)})])},t.prototype.setAnimation=function(t,e){this.numFrames=0,this.flip=e;var n=this.animations[t];console.log("********* Set animation "+t);for(var r in n){var i=n[r];switch(i.frames[0]){case a.Stop:console.log(r+": STOP"),this.stopped|=1<<Number(r);break;case a.Start:console.log(r+": START"),this.stopped&=~(1<<Number(r));break;default:console.log(r+": frame "),this.currentAnimation[r]=i}}},t.prototype.reset=function(){this.stopped=0,this.currentAnimation={}},t.prototype.vertices=function(t){for(var e=(new _(this.pos.x-t.x,this.pos.y-t.y),[]),n=0,r=this.currentFrames;n<r.length;n++){var i=r[n],o=Object.assign({},i.clip),s=Object.assign({},i.rel);this.flip&&(s.x=-(s.x+o.w));var a=new v(this.pos.x+Math.floor(s.x*this.scale),this.pos.y+Math.floor(s.y*this.scale));a.x<t.w&&a.x+o.w>t.w&&(o.w-=a.x+o.w-t.w),a.y<t.h&&a.y+o.h>t.h&&(o.h-=a.y+o.h-t.h),a.w=o.w*this.scale,a.h=o.h*this.scale,e.push.apply(e,this.tex.vertices(t,2*this.z+1,o,a,this.flip))}return e},t}(),A=function(){function t(t,e,n,r){this.tex=t,this.name=e,this.images=n,this.rect=r,this.state=0}return t.prototype.vertices=function(t){var e=this,n=this.state<1?{}:this.images[this.state-1];if(!n)return[];var r=[];return Object.keys(n).forEach(function(i){var o=n[i],s=e.tex.vertices(t,2*Number(i),new v(o[0],o[1],o[2],o[3]),new v(e.rect[0],e.rect[1],e.rect[2],e.rect[3]));r.push.apply(r,s)}),r},t}(),b=(function(){function t(){}}(),function(){function t(t,e){}return t}()),R=function(){function t(t){this.name=t,this.objs=[],this.costumes={}}return t.prototype.load=function(t,e){var n=this;new b({},[]);return this.tex=e.newTexture(),t.loadJson(this.name).then(function(r){for(var i in r.objects){var o=r.objects[i],s=o.name,a=o.images,h=o.rect;n.objs.push(new A(n.tex,s,a,h))}var u=r.background,c=u.name,l=u.images,f=u.rect,p=new A(n.tex,c,l,f);return p.state=1,n.objs.push(p),r.costumes.forEach(function(t){return n.costumes[t]=new T(t)}),Promise.all([n.tex.fromImage(n.name)].concat(Object.keys(n.costumes).map(function(r){return n.costumes[r].load(t,e)})))})},t.prototype.vertices=function(t){return this.objs.reduce(function(e,n){return e.concat(n.vertices(t))},[])},t}(),S=Math.floor(10),L=function(){function t(t){this.tex=t,this.enabled=!0,this.pos=new _(0,0),this.frame=0}return t.prototype.update=function(t){var e=this.tex.width/3;this.pos.x=t.x-Math.floor(e/2),this.pos.y=t.y-Math.floor(e/2)},t.prototype.vertices=function(t){if(!this.enabled)return[];var e=this.tex.width/3,n=Math.floor(this.frame/S);n=n>2?n-2:0;var r=e*n;return this.frame=(this.frame+1)%(5*S),this.tex.vertices(t,98,new v(r,0,e,e),new v(this.pos.x,this.pos.y,e,e))},t}(),P=function(){function t(t){var e=t.char,n=t.offset,r=t.size;this.char=e,this.x=n[0],this.y=n[1],this.width=r[0],this.height=r[1]}return t.prototype.render=function(t,e,n,r,i){for(var o=this,s=this,a=0;a<this.height;++a)!function(a){s.char[a].forEach(function(s,h){var u=i&&1==s?i:t[s];u&&e.setColor(n+o.x+h,r+o.y+a,u[0],u[1],u[2],u[3])})}(a)},t}(),F=function(){function t(t){this.name=t}return t.prototype.createCharset=function(t){var e=t.height,n=t.colors,r=t.chars;this.height=e,this.colors=[null],this.colors=this.colors.concat(n.map(function(t){return[t[0],t[1],t[2],255]})),this.chars={};for(var i in r)this.chars[i]=new P(r[i])},t.prototype.load=function(t){var e=this;return this.chars?Promise.resolve():t.loadFont(this.name).then(function(t){return e.createCharset(t)})},t.prototype.getTextRect=function(t){for(var e=0,n=0,r=0,i=!0,o=0;o<t.length;++o){var s=this.chars[t.charCodeAt(o)];if(s){s.y<0&&s.y,i&&s.x<e&&(i=!1,e=s.x);var a=s.x+s.width,h=s.y+s.height;n+=a,h>r&&(r=h)}}return{x:e,y:0,width:n-e,height:r-0}},t.prototype.render=function(t,e,n,r,i){for(var o=0;o<t.length;++o){var s=this.chars[t.charCodeAt(o)];s.render(this.colors,e,n,r,i),n+=s.x+s.width}},t}(),M=function(){function t(t){this.tex=t,this.offset=new _(0,0)}return t.prototype.setText=function(t,e,n){if(this.text!==t||e.name!==this.font.name){var r=e.getTextRect(t),i=r.x,o=r.y,s=r.width,a=r.height;this.tex.newSurface(s,a),e.render(t,this.tex,-i,-o,n),this.tex.fromSurface(),this.offset.x=i,this.offset.y=o,this.text=t,this.font=e}},t.prototype.vertices=function(t){return this.tex&&this.text&&0!=this.text.length?this.tex.vertices(t,97,new v(0,0,this.tex.width,this.tex.height),new v(this.pos.x+this.offset.x,this.pos.y+this.offset.y,this.tex.width,this.tex.height)):[]},t}(),C=function(){function t(t,e,n){this.renderer=t,this.resources=e,this.frames=0,this.lastTimestamp=Date.now(),this.mouse=new _(0,0),this.fonts={},this.costumePos=new _(80,80),this.fixedCamera=new v(0,0,n.x,n.y),this.camera=new v(0,0,n.x,n.y)}return t.prototype.createRoom=function(t){return this.room=new R(t),this.room.load(this.resources,this.renderer)},t.prototype.createCursor=function(){var t=this.renderer.newTexture();return this.cursor=new L(t),t.fromImage("cursor")},t.prototype.createFont=function(t){var e=this.fonts[t];return e||(e=new F(t),this.fonts[t]=e),e.load(this.resources)},t.prototype.init=function(){var t=this;return this.texts=[new M(this.renderer.newTexture()),new M(this.renderer.newTexture())],Promise.all([this.createRoom("Atlantis_09"),this.createCursor(),this.createFont("Atlantis_65_Charset00"),this.createFont("Atlantis_65_Charset01")]).then(function(){t.texts[0].setText("Hello world!!!",t.fonts.Atlantis_65_Charset00),t.texts[0].pos=new _(100,100),t.texts[1].setText("Hello again$$%%",t.fonts.Atlantis_65_Charset01),t.texts[1].pos=new _(150,50),t.costume=t.room.costumes.Atlantis_00_Cost03,t.costume.setAnimation(4,!1),t.costume.setAnimation(8,!1)})},t.prototype.mouseMove=function(t,e){this.mouse=t,this.cursor.update(t),e&&(this.costumePos.x=t.x+this.camera.x,this.costumePos.y=t.y+this.camera.y)},t.prototype.render=function(){var t=this;this.renderer.render(this.camera,this.room),this.texts.forEach(function(e){return t.renderer.render(t.fixedCamera,e)}),this.renderer.render(this.fixedCamera,this.cursor),this.renderer.render(this.camera,this.costume)},t.prototype.update=function(){this.mouse.x>.8*this.fixedCamera.w&&this.camera.x<300&&this.camera.x++,this.mouse.x<.2*this.fixedCamera.w&&this.camera.x>0&&this.camera.x--,this.costume.update(this.costumePos,2,1,255)},t}(),D=function(){function t(t){this.http=t}return t.prototype.loadJson=function(t){return this.http.get("assets/jsons/"+t+".json").toPromise()},t.prototype.loadFont=function(t){return this.http.get("assets/fonts/"+t+".json").toPromise()},t}(),U=function(){function t(t,e){this.ngZone=t,this.http=e,this.frames=0,this.lastTimestamp=Date.now(),this.resolution=new _(320,200)}return t.prototype.ngOnInit=function(){var t=this,e=this.canvasRef.nativeElement.getContext("webgl");this.canvasRef.nativeElement.addEventListener("mousemove",function(e){return t.mouseMove(e,!1)}),this.canvasRef.nativeElement.addEventListener("mousedown",function(e){return t.mouseMove(e,!0)}),this.canvasRef.nativeElement.addEventListener("contextmenu",function(t){return t.preventDefault()}),this.renderer=new y(e),this.renderer.viewport=new v(0,0,e.canvas.width,e.canvas.height),this.engine=new C(this.renderer,new D(this.http),this.resolution),this.engine.init().then(function(){t.running=!0,t.ngZone.runOutsideAngular(function(){return requestAnimationFrame(function(){return t.tick()})})})},t.prototype.mouseMove=function(t,e){var n=t.target.getBoundingClientRect(),r=Math.floor((t.clientX-n.left-1)*this.resolution.x/n.width),i=Math.floor((t.clientY-n.top-1)*this.resolution.y/n.height);this.engine.mouseMove(new _(r,i),e)},t.prototype.tick=function(){var t=this;if(this.running){if(this.engine.update(),this.renderer.clear(),this.engine.render(),++this.frames%500==0){var e=Date.now();console.log("Frame rate: "+5e5/(e-this.lastTimestamp)+" fps"),this.lastTimestamp=e}this.ngZone.runOutsideAngular(function(){return requestAnimationFrame(function(){return t.tick()})})}},t.ctorParameters=function(){return[{type:h.z},{type:m.c}]},t}(),N=[p],X=h._0({encapsulation:0,styles:N,data:{}}),I=(h.Y("app-viewport",U,i,{},{},[]),[f]),j=h._0({encapsulation:0,styles:I,data:{}}),O=h.Y("app-root",l,s,{},{},[]),B=n("qbdv"),k=n("fc+i"),z=h.Z(c,[l],function(t){return h._12([h._13(512,h.i,h.W,[[8,[O]],[3,h.i],h.x]),h._13(5120,h.v,h._11,[[3,h.v]]),h._13(4608,B.d,B.c,[h.v]),h._13(4608,h.h,h.h,[]),h._13(5120,h.a,h._4,[]),h._13(5120,h.t,h._9,[]),h._13(5120,h.u,h._10,[]),h._13(4608,k.b,k.s,[B.b]),h._13(6144,h.H,null,[k.b]),h._13(4608,k.e,k.f,[]),h._13(5120,k.c,function(t,e,n,r){return[new k.k(t),new k.o(e),new k.n(n,r)]},[B.b,B.b,B.b,k.e]),h._13(4608,k.d,k.d,[k.c,h.z]),h._13(135680,k.m,k.m,[B.b]),h._13(4608,k.l,k.l,[k.d,k.m]),h._13(6144,h.F,null,[k.l]),h._13(6144,k.p,null,[k.m]),h._13(4608,h.L,h.L,[h.z]),h._13(4608,k.g,k.g,[B.b]),h._13(4608,k.i,k.i,[B.b]),h._13(4608,m.h,m.m,[B.b,h.B,m.k]),h._13(4608,m.n,m.n,[m.h,m.l]),h._13(5120,m.a,function(t){return[t]},[m.n]),h._13(4608,m.j,m.j,[]),h._13(6144,m.i,null,[m.j]),h._13(4608,m.g,m.g,[m.i]),h._13(6144,m.b,null,[m.g]),h._13(5120,m.f,m.o,[m.b,[2,m.a]]),h._13(4608,m.c,m.c,[m.f]),h._13(512,B.a,B.a,[]),h._13(1024,h.l,k.q,[]),h._13(1024,h.b,function(t,e){return[k.r(t,e)]},[[2,k.h],[2,h.y]]),h._13(512,h.c,h.c,[[2,h.b]]),h._13(131584,h._2,h._2,[h.z,h.X,h.r,h.l,h.i,h.c]),h._13(2048,h.e,null,[h._2]),h._13(512,h.d,h.d,[h.e]),h._13(512,k.a,k.a,[[3,k.a]]),h._13(512,m.e,m.e,[]),h._13(512,m.d,m.d,[]),h._13(512,c,c,[]),h._13(256,m.k,"XSRF-TOKEN",[]),h._13(256,m.l,"X-XSRF-TOKEN",[])])});u.production&&Object(h.R)(),Object(k.j)().bootstrapModuleFactory(z).catch(function(t){return console.log(t)})},gFIY:function(t,e){function n(t){return Promise.resolve().then(function(){throw new Error("Cannot find module '"+t+"'.")})}n.keys=function(){return[]},n.resolve=n,t.exports=n,n.id="gFIY"}},[0]);